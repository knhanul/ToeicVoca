server {
    listen 80;
    server_name knhanul.duckdns.org;

    # 1. 프론트엔드 (React 빌드 산출물)
    # 예: /voca/ -> /srv/apps/ToeicVoca/frontend/dist/
    location /voca/ {
        root /srv/apps/ToeicVoca/frontend/dist;
        index index.html;
        try_files $uri $uri/ /voca/index.html;
    }

    # 2. 백엔드 API
    # 예: /voca/api/health -> http://localhost:4000/api/health
    location = /voca/api {
        return 301 /voca/api/;
    }

    location /voca/api/ {
        proxy_pass http://localhost:4000/api/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # 3. 업로드 파일 제공
    # 예: /voca/uploads/audio/1.mp3 -> /srv/apps/ToeicVoca/backend/uploads/audio/1.mp3
    location /voca/uploads/ {
        root /srv/apps/ToeicVoca/backend;
        autoindex off;
    }
}
